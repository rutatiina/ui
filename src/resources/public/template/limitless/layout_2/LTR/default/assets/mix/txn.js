!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=7)}({7:function(e,t,a){e.exports=a("Nq6j")},Nq6j:function(e,t){var a,n,r,i,o,s,l,c,d,m,u;!function(e){e.fn.serializeObject=function(){var t=this,a={},n={},r={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,t,a){return e[t]=a,e},this.push_counter=function(e){return void 0===n[e]&&(n[e]=0),n[e]++},e.each(e(this).serializeArray(),(function(){if(r.validate.test(this.name)){for(var n,i=this.name.match(r.key),o=this.value,s=this.name;void 0!==(n=i.pop());)s=s.replace(new RegExp("\\["+n+"\\]$"),""),n.match(r.push)?o=t.build([],t.push_counter(s),o):n.match(r.fixed)?o=t.build([],n,o):n.match(r.named)&&(o=t.build({},n,o));a=e.extend(!0,a,o)}})),a}}(jQuery),rg_txn=(a={name:"",id:0,total:0,inclusive:0,exclusive:0},n=[],r={},i={},o=0,s="-NA-",l=1,c=function(){return $("#txn_form").data("edit")},d=function(e){e=void 0===e||e;var t=$("#items_field_rows tr");if(!1===e&&t.length>1)return t.each((function(e,t){if(0===e)return!0;var a=$(this),r=a.find(".rg_item_selector");r.select2({data:n,minimumInputLength:0,placeholder:"Choose item",tags:!0,multiple:!0,maximumSelectionLength:1,selectOnClose:!0}),r.on("select2:select",(function(e){a.find(".item_row_description").focus()})),a.find(".rg_tax_selector").select2({allowClear:!0,multiple:!0,maximumSelectionLength:1}),r.val(r.data("value")).trigger("change"),a.find(".item_row_description").keyup()})),!0;var a=t.length-1,r=$(".items_row_template").clone();r.removeClass("items_row_template hidden"),r.attr("id","row_"+a),r.find("[name^=items]").each((function(){var e=$(this).attr("name");$(this).attr("name",e.replace("_index_",a)),$(this).attr("data-row",a)})),r.appendTo("#items_field_rows"),r.find(".rg_item_selector").attr("data-row",a),r.find(".rg_tax_selector").attr("data-row",a),r.find(".item_row_delete").attr("data-row",a),r.find(".rg_item_selector").select2({data:n,minimumInputLength:0,placeholder:"Choose / Type",tags:!0,multiple:!0,maximumSelectionLength:1,selectOnClose:!0}),r.on("select2:select",(function(e){r.find(".item_row_description").focus()})),r.find(".rg_item_selector").focus(),r.find(".rg_tax_selector").select2({allowClear:!0,multiple:!0,maximumSelectionLength:1})},m=function(e,t){if(void 0===e)return console.log("not calling this function. row_id: "+e),!1;void 0===i[e]&&(i[e]={taxable_amount:0}),r={};var n=$("#row_"+e);rate=rg_number(n.find(".item_row_rate").val()),quantity=n.find(".item_row_quantity").val(),multiple=rg_number(rate)*rg_number(quantity),discount=function(e,t){if(item_discount=0,!rg_empty(e))if("%"==e.substr(-1,1)){var a=e.substr(0,e.length-1);if(isNaN(a))return 0;item_discount=rg_number(t)*(rg_number(a)/100)}else item_discount=isNaN(e)?0:rg_number(e);return rg_number(item_discount)}(n.find(".item_row_discount").val(),multiple),taxableAmount=multiple-discount,row_total=taxableAmount,i[e]={type:null,type_id:0,name:"",description:"",rate:rate,quantity:quantity,total:multiple,multiple:multiple,discount:discount,taxable_amount:taxableAmount,tax:$.extend({},a),row_total:row_total},item=n.find(".rg_item_selector").select2("data"),void 0===item||0===item.length||(item=item[0],i[e].type=item.type,i[e].type_id=isNaN(item.id)?0:item.id,i[e].name=item.text,i[e].description=n.find(".item_row_description").val(),n.find(".item_row_description").removeClass("hidden")),selectedTaxes=n.find(".rg_tax_selector").select2("data"),taxSelected=void 0===selectedTaxes?void 0:selectedTaxes[0],void 0===taxSelected?(taxRateOrValue="",taxMethod="exclusive"):(taxRateOrValue=taxSelected.id,taxMethod=taxSelected.element.dataset.method),tax=function(e,t,a){if(void 0===e)return 0;if(e.length>0){if("%"==e.substr(-1,1)){var n=e.substr(0,e.length-1);return isNaN(n)?0:"inclusive"===a?t-t/(1+rg_number(n)/100):t*(rg_number(n)/100)}return rg_number(e)}return 0}(taxRateOrValue,taxableAmount,taxMethod),"inclusive"===taxMethod&&(i[e].taxable_amount=rg_number(taxableAmount)-rg_number(tax)),tax>0?(tax_selected=n.find(".rg_tax_selector").select2("data")[0],i[e].tax.name=tax_selected.text,i[e].tax.id=tax_selected.element.dataset.id,i[e].tax.total=rg_number(tax),"inclusive"===taxMethod?i[e].tax.inclusive=rg_number(tax):i[e].tax.exclusive=rg_number(tax)):i[e].tax=$.extend({},a),o="inclusive"===taxMethod?rg_number(rg_number(rate)*rg_number(quantity)-rg_number(discount)):rg_number(rg_number(rate)*rg_number(quantity)-rg_number(discount)+rg_number(tax)),n.find(".item_row_total").val(rg_number_format(o,rg_decimal_places,".",",")),i[e].row_total=rg_number(o);var s=0,c=0,d=0;$.each(i,(function(e,t){t.tax.id>0&&(r[t.tax.id]={id:t.tax.id,name:t.tax.name,inclusive:0,exclusive:0,total:0})})),$.each(i,(function(e,t){s+=t.taxable_amount,c=rg_number(c)+rg_number(t.total)+rg_number(t.tax.exclusive),d=rg_number(d)+rg_number(t.discount),t.tax.id>0&&(r[t.tax.id].total+=rg_number(t.tax.total),r[t.tax.id].inclusive+=rg_number(t.tax.inclusive),r[t.tax.id].exclusive+=rg_number(t.tax.exclusive))})),$("#txn_subtotal").html(rg_number_format(s,rg_decimal_places,".",",")),$("#txn_total").html(rg_number_format(c,rg_decimal_places,".",",")),$("#txn_exchange_amount").html(rg_number_format(c/l,rg_decimal_places,".",",")),o=c;var m=5===$(".items_row_template td").length?2:3;$("._tax_amount_").val(rg_number_format(tax,rg_decimal_places,".","")),tax>0?$("#expense_tax_summary").html("Tax is "+taxMethod):$("#expense_tax_summary").html(""),html="",d>0&&(html+='                <tr>                    <td class="p-15 no-border"></td>                    <td class="p-15 no-border-left no-border-top no-border-right text-bold" colspan="'+m+'">Discount</td>                    <td class="no-border-left no-border-top no-border-right text-right pr-10" colspan="2">('+rg_number_format(d,rg_decimal_places,".",",")+")</td>                </tr>            "),$.each(r,(function(e,t){html+='                <tr>                    <td class="p-15 no-border"></td>                    <td class="p-15 no-border-left no-border-top no-border-right text-bold" colspan="'+m+'">'+t.name+'</td>                    <td class="no-border-left no-border-top no-border-right text-right pr-10" colspan="2">'+rg_number_format(t.total,rg_decimal_places,".",",")+"</td>                </tr>            "})),$("#txn_totals").html(html)},u=function(){var e=$("#txn_form");e.trigger("reset"),e.find(".select").val("").trigger("change"),e.find(".select-search").val("").trigger("change"),e.find("[name=internal_ref]").val(""),e.find(".item_row_description").val("").hide(),$("[id^=row_]").not(".on-reset-remove").remove(),$.each(i,(function(e,t){$element=$("#row_"+e),console.log("Form reset"),$element.find(".item_row_rate").val(0),m(e),delete i[e],$element.not(".on-reset-remove").find(".rg_item_selector, .rg_tax_selector").select2("destroy"),$element.not(".on-reset-remove").remove()})),i=[],d(),$("#rg-num-of-attahed-files").html(""),$("#rg-attahed-file-names").html(""),$("#dropzone_remove_all_files").html(""),$("#txn_totals").html(""),$("#txn_subtotal").html("0.00"),$("#txn_total").html("0.00"),$("div.btn-group").removeClass("open"),$("#txn_exchange_rate").hide(),$("#contact_currency").addClass("hidden"),"-NA-"!==s&&e.find("[name=number]").val(s)},{init:function(){var e,t;c(),function(){var e=$(".rg_item_selector");if(void 0===e.data("url"))return console.log("Will not get items. data-url: "+e.data("url")),!1;e.length&&$.ajax({url:e.data("url"),method:"POST",dataType:"json",success:function(e,t,a,r){n=e},complete:function(){d(!1),$("#txn_form").data("edit",null)}}),$(".select-results-color-danger").select2({containerCssClass:"bg-danger-400"})}(),$("#txn_form").on("change","[name=payment_terms], [name=date_time]",(function(e){var t=$("#txn_form [name=payment_terms]").val(),a=$("#txn_form [name=due_date]");if(date_time=$("#txn_form [name=date_time]").val(),DueDate="",""===date_time)return!0;try{var n=new Date(date_time.split("-"))}catch(e){return a.val(DueDate),""}if(""==t)return a.val(""),"";"Net7"==t?n.setDate(n.getDate()+7):"Net10"==t?n.setDate(n.getDate()+10):"Net30"==t?n.setDate(n.getDate()+30):"Net60"==t?n.setDate(n.getDate()+60):"Net90"==t?n.setDate(n.getDate()+90):"EOM"==t&&(n=new Date(n.getFullYear(),n.getMonth()+1,0));var r=("0"+n.getDate()).slice(-2),i=("0"+(n.getMonth()+1)).slice(-2),o=n.getFullYear();return DueDate=o+"-"+i+"-"+r,a.val(DueDate),DueDate})),(e=$("#txn_form")).on("select2:opening",".rg_item_selector.select2-hidden-accessible",(function(e){""===$("[name=contact_id]").val()&&(console.log("Contact is required"),$("#fieldset_select_contact").removeClass("select_contact").addClass("select_contact_required"),$("#contact_required_message").removeClass("hidden"),e.preventDefault())})),e.on("change",".rg_item_selector",(function(t){element=$(this),item={quantity:1,rate:0,id:0,discount:0,total:0},selected=$.extend({},element.select2("data")[0]),"undefined"==typeof selected?selected={rate:0,tax_id:0}:rg_empty(selected.description)||e.find("#row_"+element.data("row")+" .item_row_description").val(selected.description).removeClass("hidden"),c()||void 0===selected.rate||(item.rate=rg_number(rg_number(selected.rate)/rg_number(l)),$("#row_"+element.data("row")).find(".item_row_rate").val(item.rate.toFixed(rg_decimal_places))),m(element.data("row"))})),e.on("keyup",".item_row_rate, .item_row_discount, .item_row_quantity",(function(e){element=$(this),m(element.data("row"))})),e.on("keyup",".item_row_description",(function(e){element=$(this),m(element.data("row")),i[element.data("row")].description=element.val()})),e.on("change",".rg_tax_selector",(function(e){element=$(this),m(element.data("row"))})),$("#txn_form").on("click",".item_row_delete",(function(e){return element=$(this),row_id=element.data("row"),e.preventDefault(),e.stopPropagation(),$("#row_"+row_id).find(".item_row_rate").val(0),m(row_id),delete i[row_id],$("#row_"+row_id).find(".rg_item_selector, .rg_tax_selector").select2("destroy"),$("#row_"+row_id).remove(),!0})),$("#txn_form").on("change","#recurring_measurement select",(function(e){var t=$(this).val(),a=$("#recurring_frequency"),n=$("#recurring_measurement"),r=$("#recurring_custom_config");"custom"===t?r.removeClass("hidden"):r.addClass("hidden"),"day"===t||"week"===t||"month"===t||"year"===t?(a.removeClass("hidden"),n.removeClass("col-lg-12").addClass("col-lg-8 no-padding-left")):(a.addClass("hidden"),n.removeClass("col-lg-8 no-padding-left").addClass("col-lg-12"))})),$("[name=contact_id]").change((function(){var e=$(this);if(""==$(this).val())return $("#fieldset_select_contact").removeClass("select_contact").addClass("select_contact_required"),$("#contact_required_message").removeClass("hidden"),!1;$("#fieldset_select_contact").removeClass("select_contact_required").addClass("select_contact"),$("#contact_required_message").addClass("hidden"),$("#contact_currency").removeClass("hidden");var t=jQuery.parseJSON(JSON.stringify(e.find(":selected").data("exchange_rates")));$("#base_currency").html(""),$("#base_currency").select2("destroy");var a=[];$.each(t,(function(e,t){a.push({id:e,text:e,exchange_rate:t})})),$("#base_currency").select2({minimumResultsForSearch:1/0,data:a}),$("#base_currency").val(Object.keys(t)[0]).trigger("change")})),$("#base_currency").change((function(){var e=$.extend({},$(this).select2("data")[0]);$("#txn_base_currency").html(e.id),$("[name=quote_currency]").val()!=e.id?(e=$.extend({},$(this).select2("data")[0]),l=rg_number(e.exchange_rate),$("#txn_exchange_rate").show(),$("[name=exchange_rate]").val(l)):($("#txn_exchange_rate").hide(),$("[name=exchange_rate]").val(e.exchange_rate),l=e.exchange_rate),$("#txn_form").find(".rg_item_selector").not("[name*='_index_']").change()})),t="draft",Dropzone.options.rgDropzone={autoProcessQueue:!1,addRemoveLinks:!0,uploadMultiple:!0,parallelUploads:5,paramName:"file",maxFiles:5,maxFilesize:5,dictDefaultMessage:"Drop files to upload <span>or CLICK</span>",clickable:"#rg-txn-attache-files, #rg-dropzone",createImageThumbnails:!1,init:function(){for(var e=document.querySelectorAll(".submit_txn_form"),a=this,n=$("#txn_form"),l=$("#rg-num-of-attahed-files"),c=$("#rg-attahed-file-names"),d=$("#dropzone_remove_all_files"),m=null,_=0;_<e.length;_++)e[_].addEventListener("click",(function(e){if(m=$(this).data("onsuccess"),resetForm=$(this).data("reset-form"),e.preventDefault(),e.stopPropagation(),a.processQueue(),0===a.getUploadingFiles().length){console.log("Txn has no files to upload"),PNotify.removeAll();var t=new PNotify({text:"Please wait as perform some magic...",addclass:"bg-primary",type:"info",icon:"icon-spinner4 spinner",hide:!1,buttons:{closer:!0,sticker:!1},opacity:.9,width:"350px"}),l={buttons:{closer:!0,sticker:!0},width:"350px"};data=n.serializeObject(),data._token=n.find("[name=_token]").val(),data._method=n.find("[name=_method]").val(),!0===n.data("use-native-fields")||(data.items=$.extend({},i),data.taxes=$.extend({},r),data.total=o,data.on_success=m),$.ajax({url:n.attr("action"),method:n.attr("method"),data:data,dataType:"json",success:function(e,a,r,i){!0===e.status?(l.title="Done!",l.text=e.message,l.addclass="bg-success",l.type="success",l.icon="icon-checkmark3",l.opacity=1,l.width=PNotify.prototype.options.width,t.update(l),void 0!==e.callback&&(window.location.href=e.callback),"PUT"!==data._method&&"PATCH"!==data._method||history.go(-1),"draft"===data.on_submit||data.on_submit,"-NA-"!==e.number&&n.find("[name=number]").val(e.number),s=e.number,u()):(l.title="Error(s)!",l.text=e.message,l.addclass="bg-danger",l.type="danger",l.icon="icon-alert",t.update(l))}})}}));d.click((function(e){e.preventDefault(),e.stopPropagation(),a.removeAllFiles(),l.html(""),c.html(""),d.hide()})),a.on("addedfile",(function(e){setTimeout((function(){get_accepted_files=a.getAcceptedFiles().length,l.html(get_accepted_files+" file(s) attached."),c.append("<br>"+e.name),d.show()}),10)})),a.on("sending",(function(e,t,a){PNotify.removeAll(),new PNotify({text:"Please wait as perform some magic xxx...",addclass:"bg-primary",type:"info",icon:"icon-spinner4 spinner",hide:!1,buttons:{closer:!0,sticker:!1},opacity:.9,width:"350px"}),$.each(n.serializeObject(),(function(e,t){"items"!=e&&a.append(e,JSON.stringify(t))})),!0===n.data("use-native-fields")||(a.append("items",JSON.stringify(i)),a.append("taxes",JSON.stringify(r)),a.append("total",JSON.stringify(o)),a.append("on_success",m))})),a.on("processing",(function(e){a.options.url=n.attr("action")})),a.on("success",(function(e,n){console.log("Txn has files to upload"),a.removeFile(e),n=JSON.parse(n),PNotify.removeAll();var r=new PNotify({text:"Please wait as perform some magic xxx...",addclass:"bg-primary",type:"info",icon:"icon-spinner4 spinner",hide:!1,buttons:{closer:!0,sticker:!1},opacity:.9,width:"350px"}),i={buttons:{closer:!0,sticker:!0},width:"350px"};!0===n.status?(i.title="Done!",i.text=n.message,i.addclass="bg-success",i.type="success",i.icon="icon-checkmark3",i.opacity=1,i.width=PNotify.prototype.options.width,r.update(i),"view"===t.on_submit||"draft"===t.on_submit||t.on_submit,s=n.number,!0===resetForm&&u()):(i.title="Error(s)!",i.text=n.message,i.addclass="bg-danger",i.type="danger",i.icon="icon-alert",r.update(i))}))}},$("[name=exchange_rate]").change((function(){l=rg_number($(this).val())}));try{$("#datatable-invoices").DataTable({ajax:"/invoices/datatable_json/",columnDefs:[{orderable:!1,className:"select-checkbox",targets:"checkbox"}],select:{style:"os",selector:"td:first-child"},ordering:!1,info:!1,bLengthChange:!1,bFilter:!1,iDisplayLength:20,aoColumns:[{mDataProp:"id"},{mDataProp:"number",sClass:"pl-5"},{mDataProp:"total",sClass:""}],fnRowCallback:function(e,t,a,n){var r='<h6 class="no-margin"><span>'+t.contact_name+'</span><small class="display-block text-muted"><a href="/invoices/view/'+t.id+'">#'+t.number+"</a> | "+t.date+"</small></h6>",i='<h6 class="no-margin text-right"><small>'+t.quote_currency+"</small> "+t.total+'<small class="display-block text-muted text-size-small">'+t.status+"</small></h6>";$("td:eq(0)",e).html(""),$("td:eq(1)",e).html(r),$("td:eq(2)",e).html(i)}})}catch(e){console.log(e)}},new_item:function(){d()},show_recurring:function(){var e;(e=$("#txn_recurring")).hasClass("hidden")?(e.removeClass("hidden"),window.scrollTo(window.scrollX,e.offset().top-50)):e.addClass("hidden")},form_reset:function(){u()},reset_txn_form:function(){u()}}),jQuery(document).ready((function(){$.extend($.fn.dataTable.defaults,{autoWidth:!1,columnDefs:[{orderable:!1,width:"100px",targets:[5]}],dom:'<"datatable-header"fl><"datatable-scroll-wrap"t><"datatable-footer"ip>',language:{search:"<span>Filter:</span> _INPUT_",searchPlaceholder:"Type to filter...",lengthMenu:"<span>Show:</span> _MENU_",paginate:{first:"First",last:"Last",next:"&rarr;",previous:"&larr;"}},drawCallback:function(){$(this).find("tbody tr").slice(-3).find(".dropdown, .btn-group").addClass("dropup")},preDrawCallback:function(){$(this).find("tbody tr").slice(-3).find(".dropdown, .btn-group").removeClass("dropup")}}),rg_txn.init()}))}});